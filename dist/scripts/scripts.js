"use strict";angular.module("svgArtistApp",["ngAnimate","ngResource","ngRoute","ngSanitize","ngMaterial","ngMdIcons"]).config(["$routeProvider",function(a){a.when("/svg-artist/demo",{templateUrl:"views/demo/svg-artist.html",controller:"DemoController",controllerAs:"ctrl"})}]),angular.module("svgArtistApp").directive("svgArtistTools",function(){return{templateUrl:"views/directives/svg-artist-tools.html",restrict:"E",scope:{settings:"=",svgInstance:"="}}}),angular.module("svgArtistApp").directive("svgArtistLayerPanel",function(){return{templateUrl:"views/directives/svg-artist-layer-panel.html",restrict:"E",link:function(a,b){}}}),angular.module("svgArtistApp").filter("keyboardShortcut",["$window",function(a){return function(b){if(b){var c=b.split("-"),d=/Mac OS X/.test(a.navigator.userAgent),e=!d||c.length>2?"+":"",f={M:d?"âŒ˜":"Ctrl",A:d?"Option":"Alt",S:"Shift"};return c.map(function(a,b){var d=b==c.length-1;return d?a:f[a]}).join(e)}}}]),angular.module("svgArtistApp").factory("SvgArtist",function(){var a=function(a){var b=this;Object.keys(a).forEach(function(c){b[c]=a[c]}),this.svgContainer=d3.select(this.target),this.svgArtist=this.svgContainer.append("g").attr("name","svgArtist").attr("class","svg-artist"),this.Layers=[]};return a.prototype.returnSvgItemName=function(a){return a[0][0].nodeName},a.prototype.makeSelection=function(){this.selectItemActive=!this.selectItemActive},a}),angular.module("svgArtistApp").factory("SvgArtistLine",function(){var a=function(a){var b=this;Object.keys(a).forEach(function(c){b[c]=a[c]})};return a.prototype.mousedown=function(a,b){var c=d3.mouse(b.node());a.attr("x1",c[0]).attr("y1",c[1]).attr("x2",c[0]).attr("y2",c[1]).attr({"class":"drawn-line",fill:"none","shape-rendering":"crispEdges","stroke-width":"2px",stroke:"steelblue","stroke-linecap":"round"}),b.on("mousemove",function(){mousemove(b,a)})},a.prototype.mousemove=function(a,b){var c=d3.mouse(a.node());b.attr("x2",c[0]).attr("y2",c[1])},a.prototype.activateCreateLine=function(){var a=this;this.createLineActive=!0,this.addLayerIfNone();var b=this.svgContainer,c=this.selectedLayer.layer.append("line").attr("name","line");this.selectedLayer.svgItems.unshift(c),b.on("mousedown",function(){mousedown(c,b)}).on("mouseup",function(){a.createLineActive=!1,b.on("mousemove",null),b.on("mousedown",null),b.on("mouseup",null),$rootScope.$apply()})},a.prototype.selectSvgItem=function(a,b){var c=a.node().getBBox(),d=b.layer.append("svg:rect").attr("x",c.x).attr("y",c.y).attr("width",c.width).attr("height",c.height).attr("name","bounding-box").attr("class","bounding-box").style("fill","#ccc").style("fill-opacity",".3").style("stroke","#666").style("stroke-width","1.5px");b.specialItems.unshift(d)},a}),angular.module("svgArtistApp").factory("SvgArtistText",function(){var a=function(a){var b=this;Object.keys(a).forEach(function(c){b[c]=a[c]})};return a.prototype.addText=function(){var a=this;a.createTextActive=!0;var b=this.svgContainer;this.addLayerIfNone();var c="";window.addEventListener("keydown",function(a){("U+0008"===a.keyIdentifier||"Backspace"===a.keyIdentifier||"8"===a.keyCode||"text"!==document.activeElement)&&a.target===document.body&&a.preventDefault()},!0);b.on("mousedown",function(){var d=d3.mouse(b.node()),e=a.selectedLayer.layer.append("rect").attr("x",d[0]).attr("y",d[1]-20+3).attr("width",3).attr("height",20).attr("name","bounding-box").attr("class","bounding-box").style("fill","#ccc").style("fill-opacity",".3").style("stroke","#666").style("stroke-width","1.5px");a.selectedLayer.specialItems.unshift(e);var f=a.selectedLayer.layer.append("text").attr("x",d[0]).attr("y",d[1]).attr("name","text").attr("font-family","sans-serif").attr("font-size","20px");a.selectedLayer.svgItems.unshift(f),d3.select("body").on("keyup",function(){if(console.log(d3.event.keyCode,String.fromCharCode(d3.event.keyCode)),13===d3.event.keyCode||27===d3.event.keyCode)return d3.select("body").on("keyup",null),a.createTextActive=!1,e.remove(),$rootScope.$apply(),!1;c=8===d3.event.keyCode?c.substring(0,c.length-1):c+""+String.fromCharCode(d3.event.keyCode),f.text(c);var b=f.node().getBBox();e.attr("x",b.x).attr("y",b.y).attr("width",b.width).attr("height",b.height)})}).on("mouseup",function(){b.on("mousedown",null),b.on("mouseup",null)})},a}),angular.module("svgArtistApp").factory("SvgArtistSave",function(){var a=function(a){var b=this;Object.keys(a).forEach(function(c){b[c]=a[c]})};return a.prototype.binaryblob=function(){for(var a=atob(document.querySelector("canvas").toDataURL().replace(/^data:image\/(png|jpg);base64,/,"")),b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);var e=new DataView(b),f=new Blob([e],{type:"image/png"}),g=self.URL||self.webkitURL||self,h=g.createObjectURL(f),i='<img src="'+h+'">';d3.select("#img").html(i)},a.prototype.saveImageToDesktop=function(){var a=d3.select(".base-chart svg").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML,b="data:image/svg+xml;base64,"+btoa(a),c='<img src="'+b+'">';d3.select("#svgdataurl").html(c);var d=document.querySelector(".export-canvas"),e=d3.select(".base-chart svg").node().getBoundingClientRect();d.height=e.height,d.width=e.width;var f=d.getContext("2d"),g=new Image;g.src=b,g.onload=function(){f.drawImage(g,0,0),binaryblob();var a=document.createElement("a");a.download="sample.png",a.href=d.toDataURL("image/png");var b='<img src="'+a.href+'">';d3.select("#pngdataurl").html(b),a.click()}},a}),angular.module("svgArtistApp").factory("SvgArtistHistory",function(){var a=function(a){var b=this;Object.keys(a).forEach(function(c){b[c]=a[c]})};return a.prototype.undoAction=function(){this.Layers.length>0&&(this.Layers[0].item.remove(),this.Layers.shift())},a}),angular.module("svgArtistApp").run(["$templateCache",function(a){a.put("views/demo/svg-artist.html",'<div ng-cloak class="main"> <div layout="column" ng-cloak> <section layout="row" flex> <md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-md\')" style="width:200px;min-width:200px"> <md-toolbar class="md-theme-indigo"> <h1 class="md-toolbar-tools">Tools</h1> </md-toolbar> <md-content layout-padding> <svg-artist-tools settings="ctrl.settings" svg-instance="ctrl.svgArtistDemo"></svg-artist-tools> </md-content> </md-sidenav> <md-content flex layout-padding> <div layout="column svg-container" layout-fill layout-align="top center" ng-class="{\'use-cross-hairs\': ctrl.svgArtistDemo.createLineActive, \'use-grab\': ctrl.svgArtistDemo.selectItemActive, \'use-text\': ctrl.svgArtistDemo.createTextActive}"> <svg xmlns="http://www.w3.org/2000/svg" preserveaspectratio="none" class="svg-artist-demo" style="width:100%;height:900px;border: 1px solid black"> </svg> </div> <div flex></div> </md-content> <md-sidenav class="md-sidenav-right md-whiteframe-z2" md-component-id="right" md-is-locked-open="$mdMedia(\'gt-md\')"> <md-toolbar class="md-theme-light"> <h1 class="md-toolbar-tools">Layers</h1> </md-toolbar> <md-content layout-padding> <form> <md-input-container> <svg-artist-layer-panel></svg-artist-layer-panel> </md-input-container> </form> </md-content> </md-sidenav> </section> </div> </div>'),a.put("views/directives/svg-artist-layer-panel.html",'<!--<md-menu md-offset="0 -7">--><!--<md-button ng-disabled="!ctrl.svgArtistDemo.Layers.length" aria-label="Open demo menu" ng-click="$mdOpenMenu($event)">--><!--<ng-md-icon md-menu-origin icon="layers" style="fill: black" size="18"></ng-md-icon>{{ctrl.svgArtistDemo.Layers.length}}--><!--</md-button>--><!--<md-menu-content width="4">--><!--<md-menu-item ng-repeat="layer in ctrl.svgArtistDemo.Layers">--><!--<md-button aria-label="Select Layer" ng-click="ctrl.svgArtistDemo.selectItemsInLayer(layer)">--><!--<div layout="row">--><!--<p flex>{{layer.name}}</p>--><!--</div>--><!--</md-button>--><!--</md-menu-item>--><!--</md-menu-content>--><!--</md-menu>--> <div ng-repeat="layer in ctrl.svgArtistDemo.Layers"> <md-button aria-label="Select Layer" ng-click="ctrl.svgArtistDemo.selectItemsInLayer(layer)"> <div layout="row"> <p flex>{{layer.name}}</p> </div> </md-button> </div> <md-button aria-label="New Layer" ng-click="ctrl.svgArtistDemo.createNewLayer()"> <ng-md-icon icon="content_copy" style="fill: black" size="18"></ng-md-icon> </md-button> <md-button aria-label="Clear" ng-click="ctrl.svgArtistDemo.removeAllLayers()"> <ng-md-icon icon="layers_clear" style="fill: black" size="18"></ng-md-icon> </md-button> <md-input-container> <input aria-label="Selected Layer" ng-if="ctrl.svgArtistDemo.selectedLayer" ng-model="ctrl.svgArtistDemo.selectedLayer.name"> <div layout="row" ng-repeat="svgItem in ctrl.svgArtistDemo.selectedLayer.svgItems" ng-click="ctrl.svgArtistDemo.selectSvgItem(svgItem, ctrl.svgArtistDemo.selectedLayer)"> <p flex>{{ctrl.svgArtistDemo.returnSvgItemName(svgItem)}}</p> </div> </md-input-container> <md-button aria-label="Hide/Show Layer" ng-if="ctrl.svgArtistDemo.selectedLayer"> <md-icon md-svg-icon="images/icons/eye.svg"></md-icon> </md-button> <md-button aria-label="Remove Layer" ng-if="ctrl.svgArtistDemo.selectedLayer" ng-click="ctrl.svgArtistDemo.removeLayer()"> <ng-md-icon icon="delete" style="fill: black" size="18"></ng-md-icon> </md-button>'),a.put("views/directives/svg-artist-tools.html",'<md-button ng-if="settings.showSelector" aria-label="Select" ng-class="{\'md-raised\':svgInstance.selectItemActive}" ng-click="svgInstance.makeSelection()"> <md-icon md-svg-icon="images/icons/arrow-up-left.svg" style="width: 18px; height: 18px"></md-icon> </md-button> <md-button ng-if="settings.showPen" aria-label="Pen"> <md-icon md-svg-icon="images/icons/pen.svg" style="width: 18px; height: 18px"></md-icon> </md-button> <md-button ng-if="settings.showLine" aria-label="Add Line" ng-class="{\'md-raised\':svgInstance.createLineActive}" ng-click="svgInstance.activateCreateLine()"> <ng-md-icon icon="create" style="fill: black" size="18"></ng-md-icon> </md-button> <md-button ng-if="settings.showText" aria-label="Add Text" ng-click="svgInstance.addText()" ng-class="{\'md-raised\':svgInstance.createTextActive}"> <ng-md-icon icon="text_format" style="fill: black" size="18"></ng-md-icon> </md-button> <md-button ng-if="settings.showSave" aria-label="Save" ng-click="svgInstance.saveImageToDesktop()"> <ng-md-icon icon="save" style="fill: black" size="18"></ng-md-icon> </md-button>')}]);